parameters:
    oro_multi_currency.entity.rate.class: Oro\Bundle\MultiCurrencyBundle\Entity\Rate

services:
    oro_multi_currency.config.currency:
        class: 'Oro\Bundle\MultiCurrencyBundle\Config\MultiCurrencyConfigProvider'
        decorates: oro_currency.config.currency
        arguments:
            - '@oro_config.manager'
            - '@oro_config.global'

    oro_multi_currency.currency_filter:
        class: Oro\Bundle\MultiCurrencyBundle\Filter\MultiCurrencyFilter
        arguments:
            - '@form.factory'
            - '@oro_filter.filter_utility'
            - '@oro_currency.helper.currency_name'
        tags:
            - { name: oro_filter.extension.orm_filter.filter, type: multi_currency, datasource: orm }

    oro_multi_currency.datagrid.listener.converted_value_column:
        class: Oro\Bundle\MultiCurrencyBundle\Datagrid\ConvertedValueColumnListener
        arguments:
            - '@oro_currency.query.currency_transformer'
            - '@oro_entity.orm.entity_class_resolver'
            - '@translator'
            - '@oro_currency.config.currency'
            - '@oro_currency.helper.currency_name'
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.before, method: onBuildBefore, priority: 255 }
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.after, method: onBuildAfter, priority: 255 }

    oro_multi_currency.query.currency_transformer:
        class: Oro\Bundle\MultiCurrencyBundle\Query\CurrencyQueryBuilderTransformer
        decorates: oro_currency.query.currency_transformer
        arguments:
            - '@oro_multi_currency.provider.rate'

    oro_multi_currency.rate.cache:
        public: false
        parent: oro.cache.abstract
        calls:
            - [ setNamespace, [ 'oro_multi_currency.rate' ] ]

    oro_multi_currency.entity_manager.link:
        tags:
            - { name: oro_service_link, service: doctrine.orm.entity_manager }

    oro_multi_currency.provider.rate:
        class: Oro\Bundle\MultiCurrencyBundle\Provider\RateProvider
        lazy:  true
        arguments:
            - '@oro_multi_currency.entity_manager.link'
            - '@oro_security.security_facade.link'
            - '@oro_multi_currency.rate.cache'
            - '@logger'

    oro_multi_currency.converter.rate:
        class: Oro\Bundle\MultiCurrencyBundle\Converter\RateConverter
        decorates: oro_currency.converter.rate
        arguments:
            - '@oro_multi_currency.provider.rate'
            - '@oro_currency.config.currency'

    oro_multi_currency.twig.rate_converter:
        class: Oro\Bundle\MultiCurrencyBundle\Twig\RateConverterExtension
        decorates: oro_currency.twig.rate
        arguments:
            - '@oro_multi_currency.converter.rate'
            - '@oro_currency.helper.currency_name'
            - '@oro_currency.config.currency'
        tags:
            - { name: twig.extension }

    oro_multi_currency.virtual_field_provider:
        class: Oro\Bundle\MultiCurrencyBundle\Provider\BaseCurrencyVirtualFieldProvider
        arguments:
            - '@oro_entity_config.provider.multicurrency'
            - '@oro_currency.query.currency_transformer'
            - '@oro_currency.config.currency'
            - '@oro_currency.helper.currency_name'
            - '@translator'
            - '@logger'
        tags:
            - { name: oro_entity.virtual_field_provider, priority: 160 }

    oro_multi_currency.handler.currency_rates_handler:
          class: Oro\Bundle\MultiCurrencyBundle\Form\Handler\CurrencyRatesHandler
          arguments:
            - '@doctrine.orm.entity_manager'
            - '@oro_multi_currency.provider.rate'

    oro_multi_currency.configurator.currency_configurator:
          class: Oro\Bundle\MultiCurrencyBundle\Form\Configurator\CurrencyConfigurator
          arguments:
              - '@event_dispatcher'
              - '@doctrine.orm.entity_manager'

    oro_multi_currency.validator.organization_currency:
          class: Oro\Bundle\MultiCurrencyBundle\Validator\Constraints\OrganizationCurrencyValidator
          arguments:
              - '@doctrine.orm.entity_manager'
              - '@oro_config.organization'
          tags:
              - { name: validator.constraint_validator, alias: oro_multi_currency.validator.organization_currency }

    oro_multi_currency.validator.currency_not_used_in_entities:
          class: Oro\Bundle\MultiCurrencyBundle\Validator\Constraints\CurrencyNotUsedInEntitiesValidator
          arguments:
              - '@oro_multi_currency.currency_checker_provider.chain'
          tags:
              - { name: validator.constraint_validator, alias: oro_multi_currency.validator.currency_not_used_in_entities }

    oro_multi_currency.validator.currency_not_used_in_config:
          class: Oro\Bundle\MultiCurrencyBundle\Validator\Constraints\CurrencyNotUsedInConfigValidator
          arguments:
              - '@oro_multi_currency.dependency_config_provider'
          tags:
              - { name: validator.constraint_validator, alias: oro_multi_currency.validator.currency_not_used_in_config }

    oro_multi_currency.validator.rates:
          class: Oro\Bundle\MultiCurrencyBundle\Validator\Constraints\RatesValidator
          arguments:
              - '@translator'
          tags:
              - { name: validator.constraint_validator, alias: oro_multi_currency.validator.rates }

    oro_multi_currency.currency_checker_provider.chain:
          class: Oro\Bundle\MultiCurrencyBundle\Provider\CurrencyCheckerProviderChain
          arguments:
              - '@translator'

    oro_multi_currency.dependency_config_provider:
          class: Oro\Bundle\MultiCurrencyBundle\Provider\DependentConfigProvider
          public: false
          calls: # will be added in compiler pass

