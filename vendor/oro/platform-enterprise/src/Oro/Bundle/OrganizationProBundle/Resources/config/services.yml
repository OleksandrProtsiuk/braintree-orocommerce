parameters:
    oro_organizationpro.entity.class: Oro\Bundle\OrganizationBundle\Entity\Organization

    oro_organizationpro.twig.extension.organization.class: Oro\Bundle\OrganizationProBundle\Twig\OrganizationExtension
    oro_organizationpro.exclusion_provider.config.class:   Oro\Bundle\OrganizationProBundle\Provider\OrganizationExclusionProvider
    oro_organizationpro.system_mode_org_provider.class:    Oro\Bundle\OrganizationProBundle\Provider\SystemAccessModeOrganizationProvider
    oro_organizationpro.request.param_converter.class:     Oro\Bundle\OrganizationProBundle\Request\ParamConverter\RequestReportParamConverter
    oro_organizationpro.helper.class:                      Oro\Bundle\OrganizationProBundle\Helper\OrganizationProHelper
    oro_organizationpro.listener.kernel_request_listener.class: Oro\Bundle\OrganizationProBundle\EventListener\KernelRequestListener
    oro_organizationpro.listener.system_org_grid_listener.class: Oro\Bundle\OrganizationProBundle\EventListener\SystemModeOrganizationGridListener
    oro_organizationpro.event_listener.workflow_listener.class: Oro\Bundle\OrganizationProBundle\EventListener\WorkflowListener

    oro_organizationpro.exception.organization_aware_listener.class: Oro\Bundle\OrganizationProBundle\Exception\OrganizationAwareExceptionListener
    oro_organizationpro.grid.extension.organization_column.class: Oro\Bundle\OrganizationProBundle\Grid\OrganizationColumnExtension

    oro_organizationpro.event_listener.authefication.class:                 Oro\Bundle\OrganizationProBundle\EventListener\AuthenticationListener
    oro_organizationpro.content_provider.organization_switch.class:         Oro\Bundle\OrganizationProBundle\ContentProvider\OrganizationSwitchContentProvider

    # Overrides
    oro_entity.listener.navigation_listener.class: Oro\Bundle\OrganizationProBundle\EventListener\EntityNavigationListener
    oro_report.listener.navigation_listener.class: Oro\Bundle\OrganizationProBundle\EventListener\ReportNavigationListener
    oro_organization.form.extension.organization.class: Oro\Bundle\OrganizationProBundle\Form\Extension\OrganizationProFormExtension
    oro_organization.provider.filter.busines_unit_choice_tree.class: Oro\Bundle\OrganizationProBundle\Provider\Filter\ChoiceTreeBusinessUnitProvider
    oro_email.datagrid_query_factory.class: Oro\Bundle\OrganizationProBundle\Datagrid\EmailQueryFactory

    oro_organizationpro.form.extension.organization_list.class: Oro\Bundle\OrganizationProBundle\Form\Extension\OrganizationListExtension
    oro_organizationpro.form.extension.imap_check_button.class: Oro\Bundle\OrganizationProBundle\Form\Extension\ImapCheckButtonExtension
    oro_organizationpro.form.extension.choice_account_type.class: Oro\Bundle\OrganizationProBundle\Form\Extension\ChoiceAccountTypeExtension
    oro_organizationpro.form.extension.configuration_gmail_type.class: Oro\Bundle\OrganizationProBundle\Form\Extension\ConfigurationGmailTypeExtension

    oro_organizationpro.acl.voter.organization.class: Oro\Bundle\OrganizationProBundle\Acl\Voter\OrganizationAnnotationVoter

    oro_organizationpro.autocomplete.business_unit.search_handler.class:  Oro\Bundle\OrganizationProBundle\Autocomplete\BusinessUnitSearchHandler

    oro_organization.autocomplete.business_unit_tree_search_handler.class: Oro\Bundle\OrganizationProBundle\Autocomplete\BusinessUnitTreeSearchHandler
services:
    oro_organizationpro.twig.extension.organization:
        class: %oro_organizationpro.twig.extension.organization.class%
        arguments:
            - "@oro_entity_config.provider.organization"
            - "@doctrine"
            - "@translator"
            - "@oro_organizationpro.helper"
        tags:
            - { name: twig.extension }

    oro_organizationpro.twig.extension.global_organization:
        class: Oro\Bundle\OrganizationProBundle\Twig\GlobalOrganizationExtension
        arguments:
            - "@oro_security.security_facade"
            - "@oro_entity_config.provider.ownership"
            - "@oro_entity.doctrine_helper"
        tags:
            - { name: twig.extension }

    oro_organizationpro.exclusion_provider:
        class: %oro_organizationpro.exclusion_provider.config.class%
        arguments:
            - "@oro_security.security_facade.link"
            - "@oro_entity_config.provider.organization"
            - "@oro_organizationpro.system_mode_org_provider"
        tags:
            - { name: oro_entity.exclusion_provider.default }

    oro_organizationpro.system_mode_org_provider:
        class: %oro_organizationpro.system_mode_org_provider.class%

    oro_organizationpro.request.param_converter:
        class: %oro_organizationpro.request.param_converter.class%
        arguments:
            - "@oro_entity_config.provider.organization"
            - "@oro_security.security_facade"
            - "@doctrine"
        tags:
            - { name: request.param_converter, priority: 2, converter: applicable_organization_converter }

    oro_organizationpro.grid.extension.organization_column:
        class: %oro_organizationpro.grid.extension.organization_column.class%
        arguments:
            - "@oro_security.security_facade"
            - "@oro_entity_config.config_manager"
            - "@oro_entity.orm.entity_class_resolver"
            - "@oro_organizationpro.system_mode_org_provider"
        tags:
            - { name: oro_datagrid.extension }
            
    oro_organizationpro.helper:
        class: %oro_organizationpro.helper.class%
        arguments:
            - "@doctrine"
            - "@security.token_storage"

    oro_organizationpro.listener.kernel_request_listener:
        class: %oro_organizationpro.listener.kernel_request_listener.class%
        arguments:
            - "@oro_organizationpro.system_mode_org_provider"
            - "@doctrine"
            - "@oro_security.security_facade"
            - "@router"
            - "@oro_workflow.manager"
            - "@oro_security.owner.ownership_metadata_provider"
            - "@oro_entity.routing_helper"
        tags:
            - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest}

    oro_organizationpro.event_listener.system_org_grid_listener:
        class: %oro_organizationpro.listener.system_org_grid_listener.class%
        arguments:
            - "@oro_organizationpro.system_mode_org_provider"
            - "@doctrine"
            - "@oro_security.security_facade"
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.before, method: onBuildBefore, priority: 1 }

    oro_organizationpro.event_listener.workflow_listener:
        class: %oro_organizationpro.event_listener.workflow_listener.class%
        arguments:
            - "@oro_organizationpro.system_mode_org_provider"
            - "@oro_security.security_facade"
            - "@oro_entity.doctrine_helper"
            - "@oro_security.owner.ownership_metadata_provider"
        tags:
            - { name: kernel.event_listener, event: oro_action.action.handle_before, method: onBeforeAction }
            - { name: kernel.event_listener, event: oro_workflow.start_transition.handle_before_render, method: onStartTransition }

    oro_organizationpro.exception.organization_aware_listener:
        class: %oro_organizationpro.exception.organization_aware_listener.class%
        arguments:
           - "@router"
           - "@oro_organizationpro.system_mode_org_provider"
        tags:
            - { name: kernel.event_listener, event: kernel.exception, method: onKernelException }

    oro_organizationpro.event_listener.authefication:
        class: %oro_organizationpro.event_listener.authefication.class%
        arguments:
            - "@doctrine"
            - "@session"
        tags:
            - { name: kernel.event_listener, event: security.authentication.success, method: onAuthenticationSuccess }
            - { name: kernel.event_listener, event: oro_security.event.organization_switch.after, method: onOrganizationSwitchAfter }
            - { name: kernel.event_listener, event: security.interactive_login, method: onInteractiveLogin }

    oro_organizationpro.content_provider.organization_switch:
        class: %oro_organizationpro.content_provider.organization_switch.class%
        arguments:
            - "@twig"
        tags:
            - { name: oro_ui.content_provider, enabled: false }

    oro_organizationpro.form.extension.organization_list:
        class: %oro_organizationpro.form.extension.organization_list.class%
        arguments:
            - "@router"
            - "@oro_security.security_facade"
            - "@security.context"
        calls:
            - [setRequest, ["@?request="]]
        scope: request
        tags:
            - { name: form.type_extension, alias: oro_organization_choice_select2 }

    oro_organizationpro.form.extension.imap_check_button:
        class: %oro_organizationpro.form.extension.imap_check_button.class%
        arguments:
            - "@oro_security.security_facade"
        tags:
            - { name: form.type_extension, alias: oro_imap_configuration_check }

    oro_organizationpro.acl.voter.organization:
        class: %oro_organizationpro.acl.voter.organization.class%
        arguments:
            - "@oro_security.acl.annotation_provider"
            - %oro_organization.organization.entity.class%
        tags:
            - { name: security.voter, priority: -255 }

    oro_organizationpro.autocomplete.business_unit.search_handler:
            class: %oro_organizationpro.autocomplete.business_unit.search_handler.class%
            parent: oro_form.autocomplete.search_handler
            arguments:
                - %oro_organization.business_unit.entity.class%
                - ["name"]
                - "@oro_security.security_facade"
            tags:
                - { name: oro_form.autocomplete.search_handler, alias: business_units, acl_resource: oro_business_unit_view }

    oro_organizationpro.form.extension.choice_account_type:
        class: %oro_organizationpro.form.extension.choice_account_type.class%
        arguments:
            - "@oro_security.security_facade"
        tags:
            - { name: form.type_extension, alias: oro_imap_choice_account_type }

    oro_organizationpro.form.extension.configuration_gmail_type:
        class: %oro_organizationpro.form.extension.configuration_gmail_type.class%
        arguments:
            - "@oro_security.security_facade"
        tags:
            - { name: form.type_extension, alias: oro_imap_configuration_gmail }

    oro_organizationpro.api.get_config.add_organization_validator:
        class: Oro\Bundle\OrganizationProBundle\Api\Processor\Config\GetConfig\AddOrganizationValidator
        arguments:
            - '@oro_api.doctrine_helper'
            - '@oro_security.owner.ownership_metadata_provider'
            - '@oro_api.validation_helper'
        tags:
            - { name: oro.api.processor, action: get_config, extra: !identifier_fields_only&definition, targetAction: update|create, priority: -50 }

    oro_organizationpro.validator.organization:
        class: Oro\Bundle\OrganizationProBundle\Validator\Constraints\OrganizationValidator
        arguments:
           - '@doctrine'
           - '@oro_security.owner.ownership_metadata_provider'
           - '@oro_security.owner.entity_owner_accessor'
           - '@oro_security.security_facade'
        tags:
          - { name: validator.constraint_validator, alias: organization_validator }

    oro_organizationpro.event_listener.post_up_migration:
        class: 'Oro\Bundle\OrganizationProBundle\EventListener\PostUpMigrationListener'
        arguments:
            - '%installed%'
        tags:
            - { name: kernel.event_listener, event: oro_migration.post_up, method: onPostUp, priority: -128 }
